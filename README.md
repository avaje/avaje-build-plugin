![Supported JVM Versions](https://img.shields.io/badge/JVM-22-brightgreen.svg?&logo=openjdk)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://github.com/avaje/avaje-inject/blob/master/LICENSE)

# Avaje Provides Maven Plugin

Maven plugin that post-processes modular applications' `module-info.class` files after compilation to add all the required `provides` clauses for all services registered under `META-INF/services` as well as adding `requires` for certain avaje-inject plugins if applicable.

## How to use

### 1. Create a `.mvn/jvm.config` file
This plugin uses the JDK 22 [Class-File API](https://openjdk.org/jeps/457). As the feature is still in preview, create a `.mvn/jvm.config` file and add `--enable-preview` so that the maven JVM will run with preview features.

### 2. Add the plugin to your pom.xml

```xml
<plugin>
  <groupId>io.avaje</groupId>
  <artifactId>avaje-provides-maven-plugin</artifactId>
  <version>${version}</version>
  <executions>
    <execution>
      <goals>
        <goal>provides</goal> 
        <!-- Will disable avaje APT module-info spi validation -->
        <!-- Will transform a module-info after compilation -->
        <goal>add-module-spi</goal>
      </goals>
    </execution>
  </executions>
</plugin>
```

## Example `module-info.class` transformation

Given a module-info like: 

```java
module avaje.example {
  requires io.avaje.inject;
  requires io.avaje.jsonb;

  requires static io.avaje.spi;

}
```

And a `META-INF/my.example.SPIServiceInterface` file (either manually created or generated by APT):

```
my.example.SPIServiceInterfaceImpl
```
The module-info classfile will be transformed after compilation to look like:

```java
module avaje.example {
  requires io.avaje.inject;
  requires io.avaje.jsonb;
  requires io.avaje.jsonb.plugin;

  requires static io.avaje.spi;
  provides my.example.SPIServiceInterface with my.example.SPIServiceInterfaceImpl;
}
```